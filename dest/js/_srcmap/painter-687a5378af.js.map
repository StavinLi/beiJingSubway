{"version":3,"sources":["painter.js"],"names":["$","ajax","url","dataType","type","data","success","timeout","find","children","i","ls","lColor","length","replace","ps","attr","lLoop","split","n","lSlb","svg","appendTo","lp","rect","x","y","width","fill","addSvgClass","text","indexOf","isNaN","j","thisP","thisPlus","path","line","x1","y1","x2","y2","html","tspan","text1","image","height","baseVal","circle","r","cx","cy","window","panzoom","svgPanZoom","zoomEnabled","panEnabled","controlIconsEnabled","fit","center","contain","minZoom","eventsHandler","customEventsHandler","haltEventListeners","instance","initialScale","options","this","pannedX","Hammer","svgElement","pannedY","SUPPORT_POINTER_EVENTS","PointerEventInput","TouchInput","inputClass","enable","on","ev","zoomIn","hammer","deltaX","panBy","deltaY","getZoom","zoomAtPoint","scale","addEventListener","e","preventDefault","destroy"],"mappings":"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","file":"../painter.js","sourcesContent":["$.ajax({\r\n    url: \"/apis/subwaymap/beijing.xml\",\r\n    dataType: 'xml',\r\n    type: 'GET',\r\n    timeout: 5000,\r\n    success: function(data) {\r\n        var ls = $(data).find(\"sw\").children()\r\n        for (var i = 0; i < ls.length; i++) {\r\n            var ps = $(ls[i]).children()\r\n            var lColor = $(ls[i]).attr(\"lc\").replace(\"0x\", \"#\");\r\n            var lLoop = $(ls[i]).attr(\"loop\");\r\n            var lSlb = $(ls[i]).attr(\"slb\");\r\n            for (var n = 0; n < $(ls[i]).attr(\"lp\").split(\";\").length; n++) {\r\n                if ($(ls[i]).attr(\"lp\").split(\";\")[n]) {\r\n                    var lp = $(ls[i]).attr(\"lp\").split(\";\")[n].split(\",\");\r\n                    var rect = $.svg('rect').appendTo('#g-box')\r\n                    rect.attr({\r\n                        x: lp[0],\r\n                        y: lp[1],\r\n                        width: lp[2],\r\n                        height: lp[3],\r\n                        fill: lColor,\r\n                    });\r\n                    var text = $.svg('text').appendTo('#g-box')\r\n                    text.addSvgClass(\"subway-name\").attr({\r\n                        x: lp[0] * 1 + lp[2] / 2,\r\n                        y: lp[1] * 1 + lp[3] / 3 * 2,\r\n                    }).html(lSlb.split(\",\")[n].indexOf(\"机场\") == -1 ? \"地铁\" + (isNaN(lSlb.split(\",\")[n] * 1) ? lSlb.split(\",\")[n] : lSlb.split(\",\")[n] + \"号\") + \"线\" : lSlb.split(\",\")[n] + \"线\");\r\n                }\r\n            }\r\n            for (var j = 0; j < ps.length; j++) {\r\n                if (j == ps.length - 1) {\r\n                    if (lLoop === \"false\") {\r\n                        continue;\r\n                    }\r\n                }\r\n                var thisP = $(ps[j]);\r\n                var thisPlus = (j == ps.length - 1) ? $(ps[0]) : $(ps[j + 1])\r\n                if (thisP.attr(\"arc\")) {\r\n                    var path = $.svg('path').appendTo('#g-box')\r\n                    path.attr({\r\n                        d: `M${thisP.attr(\"x\")} ${thisP.attr(\"y\")} Q${thisP.attr(\"arc\").split(\":\")[0]} ${thisP.attr(\"arc\").split(\":\")[1]} ${thisPlus.attr(\"x\")} ${thisPlus.attr(\"y\")}`,\r\n                        stroke: lColor\r\n                    });\r\n                    continue;\r\n                }\r\n                var line = $.svg('line').appendTo('#g-box')\r\n                line.attr({\r\n                    x1: thisP.attr(\"x\"),\r\n                    y1: thisP.attr(\"y\"),\r\n                    x2: thisPlus.attr(\"x\"),\r\n                    y2: thisPlus.attr(\"y\"),\r\n                    stroke: lColor,\r\n                    sdata: thisP.attr(\"lb\")\r\n                })\r\n            }\r\n            for (var j = 0; j < ps.length; j++) {\r\n                var thisP = $(ps[j])\r\n                if (!thisP.attr(\"lb\")) {\r\n                    continue;\r\n                }\r\n                var text = $.svg('text').appendTo('#g-box')\r\n                text.attr({\r\n                    \"font-size\": 12,\r\n                    x: thisP.attr(\"x\") * 1 + thisP.attr(\"rx\") * 1,\r\n                    y: thisP.attr(\"y\") * 1 + thisP.attr(\"ry\") * 1 + 14,\r\n                    size: 12\r\n                })\r\n                var tspan = $.svg('tspan').appendTo(text)\r\n                tspan.html(thisP.attr(\"lb\"))\r\n                if (thisP.attr(\"iu\") === \"false\") {\r\n                    text.addSvgClass(\"disabled\")\r\n                    var text1 = $.svg('text').appendTo('#g-box')\r\n                    text1.attr({\r\n                        \"font-size\": 12,\r\n                        x: thisP.attr(\"x\") * 1 + thisP.attr(\"rx\") * 1,\r\n                        y: thisP.attr(\"y\") * 1 + thisP.attr(\"ry\") * 1 + 28,\r\n                        size: 12\r\n                    }).addSvgClass(\"disabled\")\r\n                    var tspan = $.svg('tspan').appendTo(text1)\r\n                    tspan.html(\"(暂缓开通)\")\r\n                }\r\n                if (thisP.attr(\"ex\") === \"true\") {\r\n                    var image = $.svg('image').appendTo('#g-box')\r\n                    image.attr({\r\n                        width: \"14\",\r\n                        height: \"14\",\r\n                        x: thisP.attr(\"x\") - 7,\r\n                        y: thisP.attr(\"y\") - 7\r\n                    });\r\n                    image[0].href.baseVal = `https://map.bjsubway.com/subwaymap/turn.png`;\r\n                } else {\r\n                    var circle = $.svg('circle').appendTo('#g-box')\r\n                    circle.attr({\r\n                        r: 4,\r\n                        cx: thisP.attr(\"x\"),\r\n                        cy: thisP.attr(\"y\"),\r\n                        stroke: lColor,\r\n                        sdata: thisP.attr(\"lb\")\r\n                    })\r\n                }\r\n            }\r\n        }\r\n        window.panzoom = svgPanZoom('#mobile-svg', {\r\n            zoomEnabled: true,\r\n            panEnabled: true,\r\n            controlIconsEnabled: false,\r\n            fit: false,\r\n            center: false,\r\n            contain: false,\r\n            minZoom: 0.3,\r\n            maxZoom: 5,\r\n            customEventsHandler: eventsHandler\r\n        });\r\n        panzoom.pan({ x: -950 + window.innerWidth / 2, y: -700 + window.innerHeight / 2 });\r\n    }\r\n});\r\n\r\nvar eventsHandler = {\r\n    haltEventListeners: ['touchstart', 'touchend', 'touchmove', 'touchleave', 'touchcancel'],\r\n    init: function(options) {\r\n        var instance = options.instance,\r\n            initialScale = 1,\r\n            pannedX = 0,\r\n            pannedY = 0\r\n        this.hammer = Hammer(options.svgElement, {\r\n            inputClass: Hammer.SUPPORT_POINTER_EVENTS ? Hammer.PointerEventInput : Hammer.TouchInput\r\n        })\r\n        this.hammer.get('pinch').set({\r\n            enable: true\r\n        })\r\n        this.hammer.on('doubletap', function(ev) {\r\n            instance.zoomIn()\r\n        })\r\n        this.hammer.on('panstart panmove', function(ev) {\r\n            if (ev.type === 'panstart') {\r\n                pannedX = 0\r\n                pannedY = 0\r\n            }\r\n            instance.panBy({\r\n                x: ev.deltaX - pannedX,\r\n                y: ev.deltaY - pannedY\r\n            })\r\n            pannedX = ev.deltaX\r\n            pannedY = ev.deltaY\r\n        })\r\n        this.hammer.on('pinchstart pinchmove', function(ev) {\r\n            if (ev.type === 'pinchstart') {\r\n                initialScale = instance.getZoom()\r\n                instance.zoomAtPoint(initialScale * ev.scale, {\r\n                    x: ev.center.x,\r\n                    y: ev.center.y\r\n                })\r\n            }\r\n            instance.zoomAtPoint(initialScale * ev.scale, {\r\n                x: ev.center.x,\r\n                y: ev.center.y\r\n            })\r\n        })\r\n        options.svgElement.addEventListener('touchmove', function(e) {\r\n            e.preventDefault();\r\n        });\r\n    },\r\n    destroy: function() {\r\n        this.hammer.destroy()\r\n    }\r\n}"]}